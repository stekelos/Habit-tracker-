<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Î ÏÎ¬ÎºÏ„Î¿ÏÎ±Ï‚</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #fff;
      color: #000;
      padding: 20px;
      line-height: 1.6;
      max-width: 600px;
      margin: 0 auto;
    }
    h1 {
      font-size: 22px;
      margin-bottom: 20px;
    }
    button {
      display: block;
      width: 100%;
      padding: 14px;
      margin: 12px 0;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #log {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 15px;
    }
    .suggestion {
      background: #e6f4ea;
      padding: 15px;
      border-left: 4px solid #34a853;
      margin: 20px 0;
      font-weight: bold;
    }
    .instructions {
      color: #555;
      font-size: 14px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Î ÏÎ¬ÎºÏ„Î¿ÏÎ±Ï‚: ÎšÎµÎ¹Î¼ÎµÎ½Î¹ÎºÏŒÏ‚ ÎŸÎ´Î·Î³ÏŒÏ‚</h1>

  <button id="btnAdd">+ Î¤Î¿Î½ ÎµÎ¯Î´Î± Ï„ÏÏÎ±</button>
  <button id="btnCheck">âœ“ ÎšÎ¿Î¯Ï„Î±Î¾Î± â€” Î´ÎµÎ½ Î®Ï„Î±Î½ ÎµÎºÎµÎ¯</button>
  <button id="btnReset">ğŸ—‘ï¸ Reset (3 Ï†Î¿ÏÎ­Ï‚)</button>

  <div id="suggestion" class="suggestion">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...</div>

  <div id="log"></div>

  <div class="instructions">
    â€¢ Î Î¬Ï„Î·ÏƒÎµ Â«Î¤Î¿Î½ ÎµÎ¯Î´Î± Ï„ÏÏÎ±Â» Ï„Î· ÏƒÏ„Î¹Î³Î¼Î® Ï€Î¿Ï… Ï„Î¿Î½ Î²Î»Î­Ï€ÎµÎ¹Ï‚.<br>
    â€¢ Î¤Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Î¸Ï…Î¼Î¬Ï„Î±Î¹ Ï„Î·Î½ ÏÏÎ± ÎºÎ±Î¹ Ï„Î·Î½ Î·Î¼Î­ÏÎ±.<br>
    â€¢ Î£Î¿Ï… Ï€ÏÎ¿Ï„ÎµÎ¯Î½ÎµÎ¹ Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÎºÎ±Î»ÏÏ„ÎµÏÎ· ÏƒÏ„Î¹Î³Î¼Î® Î³Î¹Î± Ï€Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ·.
  </div>

  <script>
    const days = ["Î”ÎµÏ…Ï„Î­ÏÎ±", "Î¤ÏÎ¯Ï„Î·", "Î¤ÎµÏ„Î¬ÏÏ„Î·", "Î Î­Î¼Ï€Ï„Î·", "Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®", "Î£Î¬Î²Î²Î±Ï„Î¿", "ÎšÏ…ÏÎ¹Î±ÎºÎ®"];
    let resetCount = 0;

    // Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î® Î±ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·
    let data = JSON.parse(localStorage.getItem('agent_txt')) || {
      observations: [], // { dayIndex, hour, type: 'seen' | 'checked' }
      log: []
    };

    function save() {
      localStorage.setItem('agent_txt', JSON.stringify(data));
    }

    function now() {
      const d = new Date();
      return {
        dayIndex: d.getDay() === 0 ? 6 : d.getDay() - 1, // Î”ÎµÏ…=0
        hour: d.getHours()
      };
    }

    function formatTime(entry) {
      const day = days[entry.dayIndex];
      const hour = entry.hour.toString().padStart(2, '0');
      const type = entry.type === 'seen' ? 'Î¤ÎŸÎ Î•Î™Î”Î‘' : 'Î”Î•Î Î—Î¤Î‘Î';
      return `${day} ${hour}:00 â†’ ${type}`;
    }

    function findPattern() {
      const seen = data.observations.filter(e => e.type === 'seen');
      if (seen.length === 0) return null;

      // Î‘Î½ Î­Ï‡ÎµÎ¹Ï‚ 1 Ï€Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ·: Ï€ÏÏŒÏ„ÎµÎ¹Î½Îµ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Î¼Î­ÏÎ±, Î¯Î´Î¹Î± ÏÏÎ±
      if (seen.length === 1) {
        const last = seen[0];
        const nextDay = (last.dayIndex + 1) % 7;
        return { dayIndex: nextDay, hour: last.hour, reason: "1Î· Ï€Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ·" };
      }

      // Î‘Î½ Î­Ï‡ÎµÎ¹Ï‚ â‰¥2: ÏˆÎ¬Î¾Îµ Î³Î¹Î± Î´Î¹Î±Ï†Î¿ÏÎ¬ Ï‰ÏÏÎ½/Î·Î¼ÎµÏÏÎ½
      const last = seen[seen.length - 1];
      const prev = seen[seen.length - 2];

      const dayDiff = (last.dayIndex - prev.dayIndex + 7) % 7;
      const hourDiff = last.hour - prev.hour;

      // Î‘Î½ Î¯Î´Î¹Î± ÏÏÎ±, Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ® Î¼Î­ÏÎ± â†’ Ï€ÏÏŒÎ²Î»ÎµÏˆÎµ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Î¼Î­ÏÎ±
      if (hourDiff === 0 && dayDiff > 0) {
        const nextDay = (last.dayIndex + dayDiff) % 7;
        return { dayIndex: nextDay, hour: last.hour, reason: `ÏÏ…Î¸Î¼ÏŒÏ‚: ÎºÎ¬Î¸Îµ ${dayDiff} Î·Î¼Î­ÏÎµÏ‚` };
      }

      // Î‘Î½ Î¯Î´Î¹Î± Î¼Î­ÏÎ±, Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ® ÏÏÎ± â†’ Ï€ÏÏŒÎ²Î»ÎµÏˆÎµ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÏÏÎ±
      if (dayDiff === 0 && hourDiff !== 0) {
        const nextHour = last.hour + hourDiff;
        if (nextHour >= 0 && nextHour < 24) {
          return { dayIndex: last.dayIndex, hour: nextHour, reason: `ÏÏ…Î¸Î¼ÏŒÏ‚: ÎºÎ¬Î¸Îµ ${hourDiff} ÏÏÎµÏ‚` };
        }
      }

      // Î‘Î»Î»Î¹ÏÏ‚: ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Î¼Î­ÏÎ±, Î¯Î´Î¹Î± ÏÏÎ±
      const nextDay = (last.dayIndex + 1) % 7;
      return { dayIndex: nextDay, hour: last.hour, reason: "Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®" };
    }

    function getBestNext() {
      const pattern = findPattern();
      if (!pattern) return "Î”ÎµÎ½ Î­Ï‡ÎµÎ¹Ï‚ Î´ÎµÎ¹ Ï„Î¿Î½ ÏƒÏ„ÏŒÏ‡Î¿ Î±ÎºÏŒÎ¼Î±. Î Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ­ Ï„Î¿Î½ Ï€ÏÏÏ„Î±.";

      // Î‘Ï€Î¿Ï†Ï…Î³Î® Ï€ÏÏŒÏƒÏ†Î±Ï„Î± ÎµÎ»ÎµÎ³Î¼Î­Î½Ï‰Î½ Ï‰ÏÏÎ½ (checked)
      const recentlyChecked = new Set();
      data.observations
        .filter(e => e.type === 'checked')
        .slice(-5) // Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î¿Î¹ 5 Î­Î»ÎµÎ³Ï‡Î¿Î¹
        .forEach(e => {
          recentlyChecked.add(`${e.dayIndex}-${e.hour}`);
        });

      let candidate = pattern;
      let attempts = 0;
      while (recentlyChecked.has(`${candidate.dayIndex}-${candidate.hour}`) && attempts < 24) {
        candidate.hour = (candidate.hour + 1) % 24;
        if (candidate.hour === 0) candidate.dayIndex = (candidate.dayIndex + 1) % 7;
        attempts++;
      }

      const day = days[candidate.dayIndex];
      const hour = candidate.hour.toString().padStart(2, '0');
      return `Î ÏÏŒÏ„Î±ÏƒÎ·: ${day} ${hour}:00 (${candidate.reason})`;
    }

    function addObservation(type) {
      const n = now();
      data.observations.push({ ...n, type });
      data.log.unshift(formatTime({ ...n, type }));
      if (data.log.length > 20) data.log.pop();
      save();
      updateUI();
    }

    function updateUI() {
      document.getElementById('suggestion').textContent = getBestNext();
      document.getElementById('log').textContent = data.log.join('\n');
    }

    // ÎšÎ¿Ï…Î¼Ï€Î¹Î¬
    document.getElementById('btnAdd').addEventListener('click', () => addObservation('seen'));
    document.getElementById('btnCheck').addEventListener('click', () => addObservation('checked'));

    document.getElementById('btnReset').addEventListener('click', () => {
      resetCount++;
      if (resetCount >= 3) {
        if (confirm('ÎÎ± Î´Î¹Î±Î³ÏÎ±Ï†Î¿ÏÎ½ ÏŒÎ»Î± Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±;')) {
          localStorage.removeItem('agent_txt');
          data = { observations: [], log: [] };
          updateUI();
        }
        resetCount = 0;
      }
    });

    updateUI();
  </script>
</body>
</html>
