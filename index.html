<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Habits Tracker</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Habits Tracker">

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
    }

    .container {
        max-width: 400px;
        margin: 0 auto;
        padding: 20px;
        min-height: 100vh;
        background: white;
        box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }

    .header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px 0;
    }

    .header h1 {
        color: #2563eb;
        font-size: 2.2em;
        margin-bottom: 10px;
    }

    .header p {
        color: #666;
        font-size: 1.1em;
    }

    .date-display {
        background: #f8fafc;
        padding: 15px;
        border-radius: 12px;
        text-align: center;
        margin-bottom: 25px;
        border: 2px solid #e2e8f0;
    }

    .add-habit {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
    }

    .add-habit input {
        flex: 1;
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 16px;
    }

    .add-habit input:focus {
        outline: none;
        border-color: #2563eb;
    }

    .add-habit button {
        padding: 12px 20px;
        background: #2563eb;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
    }

    .add-habit button:hover {
        background: #1d4ed8;
    }

    .habits-list {
        margin-bottom: 30px;
    }

    .habit-item {
        background: #f8fafc;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: all 0.3s ease;
    }

    .habit-item.completed {
        background: #dcfce7;
        border-color: #16a34a;
    }

    .habit-checkbox {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        border: 3px solid #cbd5e1;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    .habit-checkbox.checked {
        background: #16a34a;
        border-color: #16a34a;
        color: white;
    }

    .habit-checkbox:before {
        content: '‚úì';
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .habit-checkbox.checked:before {
        opacity: 1;
    }

    .habit-text {
        flex: 1;
        font-size: 16px;
        font-weight: 500;
    }

    .habit-streak {
        background: #fef3c7;
        color: #92400e;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
    }

    .delete-btn {
        background: #ef4444;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 6px 10px;
        cursor: pointer;
        font-size: 12px;
    }

    .stats {
        background: #f1f5f9;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        margin-bottom: 20px;
    }

    .stats h3 {
        color: #2563eb;
        margin-bottom: 15px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .stat-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .stat-number {
        font-size: 1.8em;
        font-weight: bold;
        color: #2563eb;
    }

    .stat-label {
        color: #666;
        font-size: 0.9em;
        margin-top: 5px;
    }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #666;
    }

    .empty-state svg {
        width: 64px;
        height: 64px;
        margin-bottom: 16px;
        opacity: 0.5;
    }

    @media (max-width: 480px) {
        .container {
            padding: 15px;
        }
        
        .header h1 {
            font-size: 1.8em;
        }
    }

    /* PWA Install prompt */
    .install-prompt {
        position: fixed;
        bottom: 20px;
        left: 20px;
        right: 20px;
        background: #2563eb;
        color: white;
        padding: 15px;
        border-radius: 12px;
        display: none;
        align-items: center;
        gap: 15px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .install-prompt button {
        background: white;
        color: #2563eb;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
    }

    .close-prompt {
        background: none !important;
        color: white !important;
        padding: 4px 8px !important;
        margin-left: auto;
    }

    /* Week and Month Stats */
    .extended-stats {
        background: #f1f5f9;
        padding: 18px;
        border-radius: 12px;
        margin-bottom: 25px;
        text-align: center;
    }
    .extended-stats h3 {
        color: #2563eb;
        font-size: 1.1em;
        margin-bottom: 12px;
    }
    .extended-stats .stat-row {
        display: flex;
        justify-content: space-around;
        gap: 14px;
        margin-bottom: 10px;
    }
    .extended-stats .stat-row:last-child {
        margin-bottom: 0;
    }
    .extended-stats .stat-box {
        background: white;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        flex: 1;
        padding: 12px;
        min-width: 90px;
    }
    .extended-stats .stat-label {
        font-size: 0.95em;
        color: #666;
        margin-bottom: 2px;
    }
    .extended-stats .stat-number {
        font-size: 1.45em;
        font-weight: bold;
        color: #2563eb;
    }
</style>

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù Daily Habits</h1>
            <p>Build better habits, one day at a time</p>
        </div>

    <div class="date-display">
        <strong id="currentDate"></strong>
    </div>

    <div class="add-habit">
        <input type="text" id="habitInput" placeholder="Add a new habit..." maxlength="50">
        <button onclick="addHabit()">Add</button>
    </div>

    <div class="habits-list" id="habitsList">
        <div class="empty-state" id="emptyState">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
            <h3>No habits yet!</h3>
            <p>Add your first habit to get started on your journey to better daily routines.</p>
        </div>
    </div>

    <div class="stats">
        <h3>üìä Your Progress</h3>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number" id="totalHabits">0</div>
                <div class="stat-label">Total Habits</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="completedToday">0</div>
                <div class="stat-label">Completed Today</div>
            </div>
        </div>
    </div>

    <!-- Week & Month Stats -->
    <div class="extended-stats">
        <h3>üìÖ Weekly & Monthly Stats</h3>
        <div class="stat-row">
            <div class="stat-box">
                <div class="stat-label">Completed this week</div>
                <div class="stat-number" id="completedWeek">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Days tracked this week</div>
                <div class="stat-number" id="daysTrackedWeek">0</div>
            </div>
        </div>
        <div class="stat-row">
            <div class="stat-box">
                <div class="stat-label">Completed this month</div>
                <div class="stat-number" id="completedMonth">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Days tracked this month</div>
                <div class="stat-number" id="daysTrackedMonth">0</div>
            </div>
        </div>
    </div>

</div>

<div class="install-prompt" id="installPrompt">
    <div>
        <strong>Install Daily Habits</strong><br>
        <small>Add to your home screen for quick access</small>
    </div>
    <button onclick="installApp()">Install</button>
    <button class="close-prompt" onclick="hideInstallPrompt()">√ó</button>
</div>

<script>
    // Service Worker Registration
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => console.log('SW registered'))
                .catch(error => console.log('SW registration failed'));
        });
    }

    // App state
    let habits = JSON.parse(localStorage.getItem('habits') || '[]');
    let deferredPrompt;

    // Tracking completion history
    let habitHistory = JSON.parse(localStorage.getItem('habitHistory') || '{}');

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
        updateDate();
        renderHabits();
        updateStats();
        updateExtendedStats();

        // Enter key support
        document.getElementById('habitInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addHabit();
            }
        });
    });

    // PWA Install
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById('installPrompt').style.display = 'flex';
    });

    function installApp() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((result) => {
                deferredPrompt = null;
                hideInstallPrompt();
            });
        }
    }

    function hideInstallPrompt() {
        document.getElementById('installPrompt').style.display = 'none';
    }

    function updateDate() {
        const today = new Date();
        const options = { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        };
        document.getElementById('currentDate').textContent = today.toLocaleDateString('en-US', options);
    }

    function addHabit() {
        const input = document.getElementById('habitInput');
        const habitText = input.value.trim();
        
        if (habitText === '') return;
        
        const habit = {
            id: Date.now(),
            text: habitText,
            completed: false,
            streak: 0,
            lastCompleted: null,
            createdDate: new Date().toDateString()
        };
        
        habits.push(habit);
        saveHabits();
        renderHabits();
        updateStats();
        updateExtendedStats();

        input.value = '';
    }

    function toggleHabit(id) {
        const habit = habits.find(h => h.id === id);
        if (!habit) return;
        
        const today = new Date().toDateString();
        if (habit.completed) {
            habit.completed = false;
            habit.streak = Math.max(0, habit.streak - 1);
        } else {
            habit.completed = true;
            habit.lastCompleted = today;
            habit.streak += 1;
        }
        saveHabits();
        saveHabitHistory();
        renderHabits();
        updateStats();
        updateExtendedStats();
    }

    function deleteHabit(id) {
        if (confirm('Are you sure you want to delete this habit?')) {
            habits = habits.filter(h => h.id !== id);
            saveHabits();
            saveHabitHistory();
            renderHabits();
            updateStats();
            updateExtendedStats();
        }
    }

    function renderHabits() {
        const container = document.getElementById('habitsList');
        const emptyState = document.getElementById('emptyState');
        
        if (habits.length === 0) {
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        
        const habitItems = habits.map(habit => `
            <div class="habit-item ${habit.completed ? 'completed' : ''}">
                <div class="habit-checkbox ${habit.completed ? 'checked' : ''}" 
                     onclick="toggleHabit(${habit.id})"></div>
                <div class="habit-text">${habit.text}</div>
                <div class="habit-streak">${habit.streak} day${habit.streak !== 1 ? 's' : ''}</div>
                <button class="delete-btn" onclick="deleteHabit(${habit.id})">‚úï</button>
            </div>
        `).join('');
        
        container.innerHTML = habitItems + emptyState.outerHTML;
    }

    function updateStats() {
        const totalHabits = habits.length;
        const completedToday = habits.filter(h => h.completed).length;
        
        document.getElementById('totalHabits').textContent = totalHabits;
        document.getElementById('completedToday').textContent = completedToday;
    }

    function saveHabits() {
        localStorage.setItem('habits', JSON.stringify(habits));
    }

    function saveHabitHistory() {
        // Keep a history of completed habits for date-based stats
        const today = new Date();
        const isoDate = today.toISOString().split('T')[0]; // YYYY-MM-DD
        habitHistory[isoDate] = habits.map(h => ({
            id: h.id,
            completed: h.completed
        }));
        localStorage.setItem('habitHistory', JSON.stringify(habitHistory));
    }

    // Reset completion status daily (simplified version)
    function checkNewDay() {
        const today = new Date().toDateString();
        const lastCheck = localStorage.getItem('lastCheck');
        
        if (lastCheck !== today) {
            habits.forEach(habit => {
                if (habit.lastCompleted !== today) {
                    habit.completed = false;
                }
            });
            saveHabits();
            saveHabitHistory();
            localStorage.setItem('lastCheck', today);
            renderHabits();
            updateStats();
            updateExtendedStats();
        }
    }

    // Check for new day every time app loads
    checkNewDay();

    // --- Extended stats: weekly & monthly ---
    function updateExtendedStats() {
        // Get today
        const today = new Date();
        const isoToday = today.toISOString().split('T')[0];

        // Helper to get last N days in YYYY-MM-DD
        function getPastDates(numDays) {
            let dates = [];
            for (let i = 0; i < numDays; i++) {
                let d = new Date(today);
                d.setDate(today.getDate() - i);
                dates.push(d.toISOString().split('T')[0]);
            }
            return dates;
        }

        // Helper to get all days this month
        function getMonthDates(dt) {
            let year = dt.getFullYear(), month = dt.getMonth();
            let dates = [];
            let d = new Date(year, month, 1);
            while (d.getMonth() === month) {
                dates.push(d.toISOString().split('T')[0]);
                d.setDate(d.getDate() + 1);
            }
            return dates;
        }

        // Week stats
        const weekDates = getPastDates(7);
        let completedWeek = 0;
        let daysTrackedWeek = 0;
        weekDates.forEach(dateStr => {
            if (habitHistory[dateStr]) {
                daysTrackedWeek++;
                completedWeek += habitHistory[dateStr].filter(h => h.completed).length;
            }
        });

        // Month stats
        const monthDates = getMonthDates(today);
        let completedMonth = 0;
        let daysTrackedMonth = 0;
        monthDates.forEach(dateStr => {
            if (habitHistory[dateStr]) {
                daysTrackedMonth++;
                completedMonth += habitHistory[dateStr].filter(h => h.completed).length;
            }
        });

        document.getElementById('completedWeek').textContent = completedWeek;
        document.getElementById('daysTrackedWeek').textContent = daysTrackedWeek;
        document.getElementById('completedMonth').textContent = completedMonth;
        document.getElementById('daysTrackedMonth').textContent = daysTrackedMonth;
    }
</script>

<!-- Manifest and Service Worker files would be separate files -->
<script>
    // Create manifest.json content
    const manifestContent = {
        "name": "Daily Habits Tracker",
        "short_name": "Habits",
        "description": "Track your daily habits and build better routines",
        "start_url": "/",
        "display": "standalone",
        "theme_color": "#2563eb",
        "background_color": "#ffffff",
        "orientation": "portrait",
        "categories": ["productivity", "lifestyle", "health"],
        "icons": [
            {
                "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPS[...]
                "sizes": "192x192",
                "type": "image/svg+xml"
            },
            {
                "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPS[...]
                "sizes": "512x512",
                "type": "image/svg+xml"
            }
        ]
    };

    // Create service worker content
    const serviceWorkerContent = `
        const CACHE_NAME = 'habits-tracker-v1';
        const urlsToCache = [
            '/',
            '/index.html',
            '/manifest.json'
        ];

        self.addEventListener('install', event => {
            event.waitUntil(
                caches.open(CACHE_NAME)
                    .then(cache => cache.addAll(urlsToCache))
            );
        });

        self.addEventListener('fetch', event => {
            event.respondWith(
                caches.match(event.request)
                    .then(response => {
                        if (response) {
                            return response;
                        }
                        return fetch(event.request);
                    })
            );
        });
    `;

    // For development purposes, we'll create the files dynamically
    console.log('Manifest content:', manifestContent);
    console.log('Service Worker content ready');
</script>

</body>
</html>