<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Î ÏÎ¬ÎºÏ„Î¿ÏÎ±Ï‚</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #fff;
      color: #000;
      padding: 20px;
      line-height: 1.6;
      max-width: 600px;
      margin: 0 auto;
    }
    h1 {
      font-size: 22px;
      margin-bottom: 20px;
      color: #1a202c;
    }
    button {
      display: block;
      width: 100%;
      padding: 14px;
      margin: 12px 0;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    #log {
      background: #f8fafc;
      padding: 16px;
      border-radius: 10px;
      margin: 20px 0;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 15px;
      border: 1px solid #e2e8f0;
    }
    .suggestion {
      background: #f0fdf4;
      padding: 16px;
      border-radius: 10px;
      margin: 20px 0;
      font-weight: bold;
      color: #166534;
      border: 1px solid #bbf7d0;
    }
    .instructions {
      color: #64748b;
      font-size: 14px;
      margin-top: 20px;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <h1>Î ÏÎ¬ÎºÏ„Î¿ÏÎ±Ï‚: Î‘ÎºÏÎ¹Î²Î®Ï‚ ÎšÎ±Ï„Î±Î³ÏÎ±Ï†Î®</h1>

  <button id="btnSeen">ğŸ‘ï¸ Î¤Î¿Î½ ÎµÎ¯Î´Î± Ï„ÏÏÎ± (Î¼Îµ Î»ÎµÏ€Ï„Î¬)</button>
  <button id="btnChecked">ğŸ” ÎšÎ¿Î¯Ï„Î±Î¾Î± â€” Î´ÎµÎ½ Î®Ï„Î±Î½ ÎµÎºÎµÎ¯</button>
  <button id="btnReset">ğŸ—‘ï¸ Reset (3 Ï†Î¿ÏÎ­Ï‚)</button>

  <div id="suggestion" class="suggestion">Î‘Î½Î¬Î»Ï…ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½...</div>

  <div id="log"></div>

  <div class="instructions">
    â€¢ Î Î¬Ï„Î·ÏƒÎµ Â«Î¤Î¿Î½ ÎµÎ¯Î´Î± Ï„ÏÏÎ±Â» Ï„Î·Î½ Î±ÎºÏÎ¹Î²Î® ÏƒÏ„Î¹Î³Î¼Î® Ï€Î¿Ï… Ï„Î¿Î½ Î²Î»Î­Ï€ÎµÎ¹Ï‚.<br>
    â€¢ Î¤Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± ÎºÎ±Ï„Î±Î³ÏÎ¬Ï†ÎµÎ¹: <strong>Î·Î¼Î­ÏÎ±, ÏÏÎ±, Î»ÎµÏ€Ï„Î¬</strong>.<br>
    â€¢ Î£Î¿Ï… Ï€ÏÎ¿Ï„ÎµÎ¯Î½ÎµÎ¹ Ï„Î·Î½ <strong>ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Ï€Î¹Î¿ Ï€Î¹Î¸Î±Î½Î® ÏƒÏ„Î¹Î³Î¼Î®</strong> Î²Î¬ÏƒÎµÎ¹ ÏÏ…Î¸Î¼Î¿Ï.
  </div>

  <script>
    const DAYS = ["Î”ÎµÏ…Ï„Î­ÏÎ±", "Î¤ÏÎ¯Ï„Î·", "Î¤ÎµÏ„Î¬ÏÏ„Î·", "Î Î­Î¼Ï€Ï„Î·", "Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®", "Î£Î¬Î²Î²Î±Ï„Î¿", "ÎšÏ…ÏÎ¹Î±ÎºÎ®"];
    let resetCount = 0;

    // Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î® Î±ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·
    let DB = JSON.parse(localStorage.getItem('agent_v3')) || {
      events: [], // { day, hour, minute, type: 'seen'|'checked', timestamp }
      log: []
    };

    function save() {
      localStorage.setItem('agent_v3', JSON.stringify(DB));
    }

    function now() {
      const d = new Date();
      return {
        day: d.getDay() === 0 ? 6 : d.getDay() - 1, // Î”ÎµÏ… = 0
        hour: d.getHours(),
        minute: d.getMinutes()
      };
    }

    function formatEntry(e) {
      const day = DAYS[e.day];
      const time = `${e.hour.toString().padStart(2, '0')}:${e.minute.toString().padStart(2, '0')}`;
      const action = e.type === 'seen' ? 'Î¤ÎŸÎ Î•Î™Î”Î‘' : 'Î”Î•Î Î—Î¤Î‘Î';
      return `${day} ${time} â†’ ${action}`;
    }

    function totalMinutes(day, hour, minute) {
      return day * 24 * 60 + hour * 60 + minute;
    }

    function fromTotalMinutes(total) {
      const day = Math.floor(total / (24 * 60)) % 7;
      const hour = Math.floor((total % (24 * 60)) / 60);
      const minute = total % 60;
      return { day, hour, minute };
    }

    function predictNext() {
      const seen = DB.events.filter(e => e.type === 'seen');
      if (seen.length === 0) {
        return "Î”ÎµÎ½ Î­Ï‡ÎµÎ¹Ï‚ Î´ÎµÎ¹ Ï„Î¿Î½ ÏƒÏ„ÏŒÏ‡Î¿ Î±ÎºÏŒÎ¼Î±. ÎšÎ¬Î½Îµ Ï€Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ· Ï€ÏÏÏ„Î±.";
      }

      // Î‘Î½ Î¼ÏŒÎ½Î¿ 1 Ï€Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ·: Ï€ÏÏŒÏ„ÎµÎ¹Î½Îµ +24 ÏÏÎµÏ‚ (Î±ÏÏÎ¹Î¿ Î¯Î´Î¹Î± ÏÏÎ±/Î»ÎµÏ€Ï„ÏŒ)
      if (seen.length === 1) {
        const last = seen[0];
        const next = {
          day: (last.day + 1) % 7,
          hour: last.hour,
          minute: last.minute
        };
        return formatSuggestion(next, "1Î· ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ· â†’ Î±ÏÏÎ¹Î¿");
      }

      // Î‘Î½ â‰¥2: Ï…Ï€Î¿Î»ÏŒÎ³Î¹ÏƒÎµ Î´Î¹Î±Ï†Î¿ÏÎ¬ ÏƒÎµ Î»ÎµÏ€Ï„Î¬
      const last = seen[seen.length - 1];
      const prev = seen[seen.length - 2];

      const t1 = totalMinutes(prev.day, prev.hour, prev.minute);
      const t2 = totalMinutes(last.day, last.hour, last.minute);
      const diff = t2 - t1;

      if (diff <= 0) {
        // Î‘ÏƒÏ…Î½ÎµÏ€Î®Ï‚ ÏÏ…Î¸Î¼ÏŒÏ‚ â†’ Î±ÏÏÎ¹Î¿
        const next = { day: (last.day + 1) % 7, hour: last.hour, minute: last.minute };
        return formatSuggestion(next, "Î±ÏƒÎ±Ï†Î®Ï‚ ÏÏ…Î¸Î¼ÏŒÏ‚ â†’ Î±ÏÏÎ¹Î¿");
      }

      // Î ÏÏŒÎ²Î»ÎµÏˆÎ· ÎµÏ€ÏŒÎ¼ÎµÎ½Î·Ï‚ ÏƒÏ„Î¹Î³Î¼Î®Ï‚
      const nextTotal = t2 + diff;
      const next = fromTotalMinutes(nextTotal);

      // Î‘Ï€Î¿Ï†Ï…Î³Î® Ï€ÏÏŒÏƒÏ†Î±Ï„Ï‰Î½ "checked"
      const recentChecked = new Set();
      DB.events
        .filter(e => e.type === 'checked')
        .slice(-8)
        .forEach(e => {
          recentChecked.add(`${e.day}-${e.hour}-${e.minute}`);
        });

      let attempts = 0;
      while (recentChecked.has(`${next.day}-${next.hour}-${next.minute}`) && attempts < 30) {
        next.minute = (next.minute + 5) % 60;
        if (next.minute === 0) {
          next.hour = (next.hour + 1) % 24;
          if (next.hour === 0) next.day = (next.day + 1) % 7;
        }
        attempts++;
      }

      return formatSuggestion(next, `ÏÏ…Î¸Î¼ÏŒÏ‚: ÎºÎ¬Î¸Îµ ${Math.round(diff / 60)} ÏÏÎµÏ‚ ÎºÎ±Î¹ ${diff % 60} Î»ÎµÏ€Ï„Î¬`);
    }

    function formatSuggestion({ day, hour, minute }, reason) {
      const dayName = DAYS[day];
      const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
      return `Î ÏÏŒÏ„Î±ÏƒÎ·: ${dayName} ${time} (${reason})`;
    }

    function addEvent(type) {
      const n = now();
      DB.events.push({ ...n, type, timestamp: Date.now() });
      DB.log.unshift(formatEntry({ ...n, type }));
      if (DB.log.length > 20) DB.log.pop();
      save();
      render();
    }

    function render() {
      document.getElementById('suggestion').textContent = predictNext();
      document.getElementById('log').textContent = DB.log.join('\n');
    }

    // ÎšÎ¿Ï…Î¼Ï€Î¹Î¬
    document.getElementById('btnSeen').addEventListener('click', () => addEvent('seen'));
    document.getElementById('btnChecked').addEventListener('click', () => addEvent('checked'));

    document.getElementById('btnReset').addEventListener('click', () => {
      resetCount++;
      if (resetCount >= 3) {
        if (confirm('ÎÎ± Î´Î¹Î±Î³ÏÎ±Ï†Î¿ÏÎ½ ÎŸÎ›Î‘ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±;')) {
          localStorage.removeItem('agent_v3');
          DB = { events: [], log: [] };
          render();
        }
        resetCount = 0;
      }
    });

    render();
  </script>
</body>
</html>
